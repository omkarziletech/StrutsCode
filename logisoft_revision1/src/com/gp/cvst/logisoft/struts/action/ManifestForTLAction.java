/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cvst.logisoft.struts.action;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.gp.cvst.logisoft.domain.CustAddress;
import com.gp.cvst.logisoft.domain.TransactionLedger;
import com.gp.cvst.logisoft.hibernate.dao.ArAgeingDAO;
import com.gp.cvst.logisoft.hibernate.dao.CustAddressDAO;
import com.gp.cvst.logisoft.hibernate.dao.TransactionLedgerDAO;
import com.gp.cvst.logisoft.struts.form.ManifestForTLForm;

/** 
 * MyEclipse Struts
 * Creation date: 07-02-2008
 * 
 * XDoclet definition:
 * @struts.action path="/manifestForTL" name="manifestForTLForm" input="/jsps/AccountsPayable/manifestForTL.jsp" scope="request" validate="true"
 * @struts.action-forward name="success" path="/jsps/AccountsPayable/manifestForTL.jsp"
 */
public class ManifestForTLAction extends Action {
    /*
     * Generated Methods
     */

    /**
     * Method execute
     * @param mapping
     * @param form
     * @param request
     * @param response
     * @return ActionForward
     */
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response)throws Exception {
        ManifestForTLForm manifestform = (ManifestForTLForm) form;// TODO Auto-generated method stub
        String forwardName = "";

        String buttonValue1 = manifestform.getButtonValue();
        String custName = manifestform.getCustName();

        String blno = manifestform.getBlno();
        String invnumber = manifestform.getInvno();
        //int invnumber=Integer.parseInt(invno.trim());
        String glAccountNumber = manifestform.getGlAccountNumber();
        String subledgerSourceCode = manifestform.getSubledgerSourceCode();
        String blTerms = manifestform.getBlTerms();
        String vesselNo = manifestform.getVesselNo();
        String custNo = manifestform.getCustNo();
        String chargeCode = manifestform.getChargeCode();
        String currencyCode = manifestform.getCurrencyCode();
        String journalEntryNumber = manifestform.getJournalEntryNumber();
        String subHouseBl = manifestform.getSubHouseBl();
        String containerNo = manifestform.getContainerNo();
        String transactionDate = manifestform.getTransactionDate();
        String chequeNumber = manifestform.getChequeNumber();
        String lineItemNumber = manifestform.getLineItemNumber();
        String voyageNo = manifestform.getVoyageNo();
        String masterBl = manifestform.getMasterbl();
        String status = manifestform.getStatus();
        String transactionType = manifestform.getTransactionType();
        String custmerName = manifestform.getVendor();
        Double transactionAmt = manifestform.getTransactionAmt();
        Date date = new Date();
        SimpleDateFormat format = new SimpleDateFormat("MM/dd/yyyy");
        DateFormat df = new SimpleDateFormat("MM/dd/yyyy");
        if (buttonValue1.equals("save")) {
            TransactionLedger transcactiondomain = new TransactionLedger();
            transcactiondomain.setChargeCode(chargeCode);
            transcactiondomain.setGlAccountNumber(glAccountNumber);
            transcactiondomain.setSubledgerSourceCode(subledgerSourceCode);
            transcactiondomain.setBlTerms(blTerms);
            transcactiondomain.setVoyageNo(voyageNo);
            transcactiondomain.setStatus(status);
            transcactiondomain.setCustNo(custNo);
            transcactiondomain.setCurrencyCode(currencyCode);
            transcactiondomain.setJournalEntryNumber(journalEntryNumber);
            transcactiondomain.setSubHouseBl(subHouseBl);
            transcactiondomain.setContainerNo(containerNo);
            transcactiondomain.setTransactionAmt(transactionAmt);
            transcactiondomain.setChequeNumber(chequeNumber);
            transcactiondomain.setLineItemNumber(lineItemNumber);
            transcactiondomain.setVesselNo(vesselNo);
            transcactiondomain.setMasterBl(masterBl);
            transcactiondomain.setTransactionType(transactionType);
            transcactiondomain.setBillLaddingNo(blno);
            transcactiondomain.setInvoiceNumber(invnumber);
            transcactiondomain.setCustName(custName);
            transcactiondomain.setBalance(transactionAmt);
                date = (Date) format.parse(transactionDate);
            transcactiondomain.setTransactionDate(date);
            TransactionLedgerDAO transactionDAO = new TransactionLedgerDAO();
            transactionDAO.save(transcactiondomain);
            manifestform.reset(mapping, request);
            forwardName = "success";
        }
        if (buttonValue1.equals("getCustomer")) {
            setBasicParams(custmerName, request);
            forwardName = "success";
        }
        return mapping.findForward(forwardName);
    }

    private void setBasicParams(String customerName, HttpServletRequest request)throws Exception {
        CustAddressDAO custAddressDAO = new CustAddressDAO();
        CustAddress custAddress = null;
        ArAgeingDAO arage = new ArAgeingDAO();
        List customer = null;
        List master1 = null;
        List findage = null;
        String creditHold1 = null;
        String acctNumber = null;
        customer = custAddressDAO.findAcctName(customerName);
        if (customer != null) {
            custAddress = (CustAddress) customer.get(0);
        }
        acctNumber = custAddress.getAcctNo();
        master1 = custAddressDAO.master(acctNumber);
        findage = arage.fimdAge(acctNumber);
        String creditHold = custAddressDAO.credit(acctNumber);

        request.setAttribute("master", master1);
        request.setAttribute("agemaster", findage);
        request.setAttribute("creadithold", creditHold);
        request.setAttribute("batch", custAddress);
    }
}
