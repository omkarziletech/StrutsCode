/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cvst.logisoft.struts.action;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.gp.cvst.logisoft.domain.FiscalPeriod;
import com.gp.cvst.logisoft.hibernate.dao.FiscalPeriodDAO;
import com.gp.cvst.logisoft.struts.form.EditSearchFiscalForm;

/** 
 * MyEclipse Struts
 * Creation date: 08-05-2008
 * 
 * XDoclet definition:
 * @struts.action path="/editSearchFiscal" name="editSearchfiscalform" input="/jsps/Accounting/EditFiscalCalender.jsp" scope="request"
 */
public class EditSearchFiscalAction extends Action {
    /*
     * Generated Methods
     */

    /**
     * Method execute
     * @param mapping
     * @param form
     * @param request
     * @param response
     * @return ActionForward
     */
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response)throws Exception {
        EditSearchFiscalForm editFisaclForm = (EditSearchFiscalForm) form;// TODO Auto-generated method stub
        String forwardName = "";
        HttpSession session = ((HttpServletRequest) request).getSession();
        FiscalPeriodDAO fisDAO = new FiscalPeriodDAO();
        String buttonValue = editFisaclForm.getButtonValue();
        String period = editFisaclForm.getFiscalperiod();
        String Startingdate1 = editFisaclForm.getStartingdate();
        String Endingdate1 = editFisaclForm.getEndingdate();
        Integer index = editFisaclForm.getIndex();

        int yearss = 0;

        Date date = null;
        Date date1 = null;
        SimpleDateFormat sid = new SimpleDateFormat("MM/dd/yyyy");
        List listes = null;
        List searchlist = null;

        if (buttonValue.equals("update")) {
            FiscalPeriod fis = new FiscalPeriod();


            if (session.getAttribute("searchlist") != null) {
                listes = (List) session.getAttribute("searchlist");
            }
            fis = (FiscalPeriod) listes.get(index);

            yearss = (Integer) fis.getYear();
                date = (Date) sid.parse(Startingdate1);
                date1 = (Date) sid.parse(Endingdate1);
            fis.setPeriod(period);
            fis.setStartDate(date);
            fis.setEndDate(date1);
            fisDAO.update(fis);
            session.removeAttribute("searchlist");
            searchlist = (List) fisDAO.findYear(yearss);
            session.setAttribute("searchlist", searchlist);

            request.setAttribute("buttonValue", "completed");
            forwardName = "success";

        }
        return mapping.findForward(forwardName);
    }
}