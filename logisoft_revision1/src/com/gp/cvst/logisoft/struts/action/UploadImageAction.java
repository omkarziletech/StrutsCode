/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cvst.logisoft.struts.action;

import java.io.File;
import java.io.FileOutputStream;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.upload.FormFile;

import com.gp.cvst.logisoft.struts.form.UploadImageForm;

/** 
 * MyEclipse Struts
 * Creation date: 12-31-2008
 * 
 * XDoclet definition:
 * @struts.action path="/uploadImage" name="uploadImageForm" input="/form/uploadImage.jsp" scope="request"
 */
public class UploadImageAction extends Action {
    /*
     * Generated Methods
     */

    /**
     * Method execute
     * @param mapping
     * @param form
     * @param request
     * @param response
     * @return ActionForward
     */
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response)throws Exception {
        UploadImageForm uploadImageForm = (UploadImageForm) form;// TODO Auto-generated method stub
        HttpSession session = ((HttpServletRequest) request).getSession();

            // Process the FormFile
            FormFile myFile = uploadImageForm.getTheFile();
            String contentType = myFile.getContentType();

            //Get the file name
            String fileName = myFile.getFileName();

            //int fileSize       = myFile.getFileSize();

            byte[] fileData = myFile.getFileData();

            //Get the servers upload directory real path name

            String filePath = getServlet().getServletContext().getRealPath("/upload");

            /* Save file on the server */

            if (!fileName.equals("")) {
                //Create file

                File fileToCreate = new File(filePath, fileName);
                //If file does not exists create file
                if (!fileToCreate.exists()) {
                    FileOutputStream fileOutStream = new FileOutputStream(fileToCreate);
                    fileOutStream.write(myFile.getFileData());
                    fileOutStream.flush();
                    fileOutStream.close();
                }

            }
            request.setAttribute("uploadImage", "uploadImage");

        return mapping.getInputForward();
    }
}