/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cvst.logisoft.struts.action;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.gp.cong.logisoft.beans.CitySelectionBean;
import com.gp.cong.logisoft.domain.AirRates;
import com.gp.cong.logisoft.domain.Ports;
import com.gp.cong.logisoft.domain.RefTerminal;
import com.gp.cong.logisoft.domain.RelayInquiry;
import com.gp.cong.logisoft.hibernate.dao.PortsDAO;
import com.gp.cong.logisoft.struts.form.SearchPierCodeForm;
import com.gp.cvst.logisoft.beans.BatchesBean;
import com.gp.cvst.logisoft.domain.Batch;
import com.gp.cvst.logisoft.domain.JournalEntry;
import com.gp.cvst.logisoft.hibernate.dao.BatchDAO;
import com.gp.cvst.logisoft.hibernate.dao.JournalEntryDAO;
import com.gp.cvst.logisoft.struts.form.SearchBatchForm;
import com.gp.cvst.logisoft.util.DBUtil;

/** 
 * MyEclipse Struts
 * Creation date: 02-12-2008
 * 
 * XDoclet definition:
 * @struts.action path="/searchPierCode" name="searchPierCodeForm" input="/datareference/SearchPierCode.jsp" scope="request" validate="true"
 */
public class SearchBatchaction extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		SearchBatchForm searchbatchForm = (SearchBatchForm) form;// TODO Auto-generated method stub
		HttpSession session = ((HttpServletRequest)request).getSession();
		String buttonValue=searchbatchForm.getButtonValue();
		Integer batchno=0;
		if(searchbatchForm.getBatchno()!=null && !searchbatchForm.getBatchno().equals(""))
		{
			batchno=Integer.parseInt(searchbatchForm.getBatchno());
		}
		String desc=searchbatchForm.getDesc();
		BatchDAO batchDAO=new BatchDAO();
		String search="";
		String path="";
		if(session.getAttribute("search")!=null)
		{
			search=(String)session.getAttribute("search");
		}
		if(request.getParameter("index")!=null)
		{
			int ind = Integer.parseInt(request.getParameter("index"));
			List batchList1=(List)session.getAttribute("batchLst");
			Batch bBean=new Batch();
			bBean=(Batch)batchList1.get(ind);
			session.setAttribute("batch",bBean);
			request.setAttribute("buttonValue","completed");
			if(search.equals("batches"))
			{
				session.setAttribute("batchNo",bBean.getBatchId().toString());
				path="jsps/Accounting/Batches.jsp";
			}
			else if(search.equals("searchbatch"))
			{
				path="jsps/Accounting/JournalEntry.jsp";
			}
			if(request.getAttribute("path1")!=null)
			{
				request.removeAttribute("path1");
			}
			request.setAttribute("path1", path);
		}	
		else
		{
			if(buttonValue.equals("search"))
			{ 
				List batchList=batchDAO.findBatchsearchforDojo(request.getParameter("batchno"),desc);
				session.setAttribute("batchLst", batchList);
			}
			
		}
		return mapping.findForward("searchbatch");
	}
}
