/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cong.logisoft.struts.ratemangement.action;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.util.LabelValueBean;
import org.hibernate.Session;
import org.hibernate.Transaction;

import com.gp.cong.hibernate.HibernateSessionFactory;
import com.gp.cong.logisoft.beans.NoteBean;
import com.gp.cong.logisoft.domain.AuditLogRecord;
import com.gp.cong.logisoft.domain.AuditLogRecordFcl;
import com.gp.cong.logisoft.domain.FclBuy;
import com.gp.cong.logisoft.domain.FclBuyAirFreightCharges;
import com.gp.cong.logisoft.domain.FclBuyCost;
import com.gp.cong.logisoft.domain.FclBuyCostTypeFutureRates;
import com.gp.cong.logisoft.domain.FclBuyCostTypeFutureRatesHisptory;
import com.gp.cong.logisoft.domain.GenericCode;
import com.gp.cong.logisoft.domain.TradingPartnerTemp;
import com.gp.cong.logisoft.domain.UnLocation;
import com.gp.cong.logisoft.hibernate.dao.FclBuyCostFutureRatesDAO;
import com.gp.cong.logisoft.domain.Item;
import com.gp.cong.logisoft.hibernate.dao.CustomerDAO;
import com.gp.cong.logisoft.hibernate.dao.FclBuyCostDAO;
import com.gp.cong.logisoft.hibernate.dao.FclBuyDAO;
import com.gp.cong.logisoft.hibernate.dao.GenericCodeDAO;
import com.gp.cong.logisoft.hibernate.dao.ItemDAO;
import com.gp.cong.logisoft.hibernate.dao.RefTerminalDAO;
import com.gp.cong.logisoft.hibernate.dao.UnLocationDAO;
import com.gp.cong.logisoft.struts.ratemangement.form.AddFutureFclForm;
import com.gp.cong.logisoft.util.DBUtil;

/** 
 * MyEclipse Struts
 * Creation date: 09-23-2008
 * 
 * XDoclet definition:
 * @struts.action path="/addFutureFcl" name="addFutureFclForm" input="/jsps/ratemangement/addFutureFcl.jsp" scope="request"
 */
public class AddFutureFclAction extends Action {

    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response) throws Exception {
        AddFutureFclForm addFCLRecordsForm = (AddFutureFclForm) form;// TODO Auto-generated method stub
        HttpSession session = ((HttpServletRequest) request).getSession();
        Session s = HibernateSessionFactory.getSession();
        Transaction tx = null;
        GenericCodeDAO genericCodeDAO = new GenericCodeDAO();
        GenericCode genObj = new GenericCode();
        FclBuyCostTypeFutureRates fclBuyCostTypeRates = new FclBuyCostTypeFutureRates();
        FclBuyCost fclBuyCost = new FclBuyCost();
        FclBuyAirFreightCharges fclBuyAirFreightCharges = new FclBuyAirFreightCharges();
        FclBuy fclBuy = new FclBuy();
        List unittypelist = new ArrayList();
        FclBuyCostFutureRatesDAO ffDao = new FclBuyCostFutureRatesDAO();
        FclBuyDAO fclBuyDAO = new FclBuyDAO();
        FclBuyCostDAO fclBuyCostDAO = new FclBuyCostDAO();
        SimpleDateFormat sdf = new SimpleDateFormat("MM/dd/yyyy");
        String buttonValue = addFCLRecordsForm.getButtonValue();
        String costcode = addFCLRecordsForm.getCostcode();
        String costtype = addFCLRecordsForm.getCosttype();
        String afamount = addFCLRecordsForm.getAfamount();
        String amount = addFCLRecordsForm.getAmount();
        String pcctc = addFCLRecordsForm.getPcctc();
        String contract = addFCLRecordsForm.getContact();
        String pcftf = addFCLRecordsForm.getPcftf();
        int count = 0;
        String index = addFCLRecordsForm.getIndex();
        String programid = null;
        String recordid = "";
        String buy = addFCLRecordsForm.getBuy();
        String pcretail = addFCLRecordsForm.getPcretail();
        String pccmi = addFCLRecordsForm.getPcminimun();
        DBUtil dbUtil = new DBUtil();
        String range = addFCLRecordsForm.getRange();
        ;
        String FORWARD = "";
        String trmNum = addFCLRecordsForm.getOrgTerminal();
        String portNum = addFCLRecordsForm.getDestnum();
        String comCode = addFCLRecordsForm.getComcode();
        String sslineNO = addFCLRecordsForm.getSslineno();
        String ssName = addFCLRecordsForm.getSslinename();
        String startdate = addFCLRecordsForm.getStartDate();
        String enddate = addFCLRecordsForm.getEndDate();
        String standard = addFCLRecordsForm.getStandard();
        String unittype = addFCLRecordsForm.getUnittype();
        GenericCode genericCo = null;
        String efd = addFCLRecordsForm.getEfdate();
        String currency = addFCLRecordsForm.getCurrency();
        String markup = addFCLRecordsForm.getMarkup();
        List recordsList = new ArrayList();
        Set fclset = new HashSet<FclBuyCostTypeFutureRates>();
        List costCodeList = new ArrayList();
        List secondunittype = new ArrayList();
        int codeNO = 0;
        String descCode = "";
        CustomerDAO carriersOrLineDAO = new CustomerDAO();
        TradingPartnerTemp carriersOrLineTemp = new TradingPartnerTemp();
        RefTerminalDAO refTerminalDAO = new RefTerminalDAO();
        UnLocationDAO portsDAO = new UnLocationDAO();
        if (costtype != null && !costtype.equals("") && !costtype.equals("0")) {
            GenericCode gen = genericCodeDAO.findById(Integer.parseInt(costtype));
            if (gen != null) {
                descCode = gen.getCodedesc();
            }
        }
        if (session.getAttribute("futureaddfclrecords") != null) {
            fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
        }

        fclBuy.setContract(contract);
        if (amount != null && !amount.equals("")) {
            fclBuyCostTypeRates.setActiveAmt(Double.parseDouble(amount));
        } else {

            fclBuyCostTypeRates.setActiveAmt(0.00);
        }
        if (standard != null && standard.equals("on")) {
            fclBuyCostTypeRates.setStandard("Y");
        } else {
            fclBuyCostTypeRates.setStandard("N");
        }
        if (markup != null && !markup.equals("")) {

            fclBuyCostTypeRates.setMarkup(Double.parseDouble(markup));
        } else {
            fclBuyCostTypeRates.setMarkup(0.00);
        }

        if (pcctc != null && !pcctc.equals("")) {
            fclBuyCostTypeRates.setCtcAmt(Double.parseDouble(pcctc));
        } else {
            fclBuyCostTypeRates.setCtcAmt(0.00);
        }
        if (pccmi != null && !pccmi.equals("")) {
            fclBuyCostTypeRates.setMinimumAmt(Double.parseDouble(pccmi));
        } else {
            fclBuyCostTypeRates.setMinimumAmt(0.00);
        }
        if (pcftf != null && !pcftf.equals("")) {
            fclBuyCostTypeRates.setFtfAmt(Double.parseDouble(pcftf));
        } else {
            fclBuyCostTypeRates.setFtfAmt(0.00);
        }
        if (pcretail != null && !pcretail.equals("")) {
            fclBuyCostTypeRates.setRatAmount(Double.parseDouble(pcretail));
        } else {
            fclBuyCostTypeRates.setRatAmount(0.00);
        }
        if (currency != null && !currency.equals("0") && !currency.equals("")) {
            genericCo = genericCodeDAO.findById(Integer.parseInt(currency));
            fclBuyCostTypeRates.setCurrency(genericCo);
        }
        if (efd != null && !efd.equals("")) {
            Date start = null;
            start = sdf.parse(efd);
            fclBuyCostTypeRates.setEffectiveDate(start);
        }
        /*request.setAttribute("pcctc", pcctc);
        request.setAttribute("pccmi", pccmi);
        request.setAttribute("pcftf", pcftf);
        request.setAttribute("pcretail", pcretail);
        request.setAttribute("amount", amount);
        request.setAttribute("markup", markup);*/

        if (startdate != null && startdate != "") {
            Date start = null;
            start = sdf.parse(startdate);
            fclBuy.setStartDate(start);
        }
        if (enddate != null && enddate != "") {
            Date end = null;
            end = sdf.parse(enddate);
            fclBuy.setEndDate(end);

        }
        fclBuy.setContract(contract);
        session.setAttribute("con", fclBuy);


        if (buttonValue.equals("costcode")) {
            if (costcode != null && !costcode.equals("0") && !costcode.equals("")) {


                if (startdate != null && startdate != "") {

                    Date start = null;
                    start = sdf.parse(startdate);
                    fclBuy.setStartDate(start);
                }
                if (enddate != null && enddate != "") {
                    Date end = null;
                    end = sdf.parse(enddate);
                    fclBuy.setEndDate(end);
                }

                GenericCode gen = null;
                genObj = genericCodeDAO.findById(Integer.parseInt(costcode));

                costCodeList = new ArrayList();
                boolean flag = false;
                if (session.getAttribute("costFutureCodeList") != null) {
                    costCodeList = (List) session.getAttribute("costFutureCodeList");
                    for (int i = 0; i < costCodeList.size(); i++) {
                        FclBuyCost fclBuy1 = (FclBuyCost) costCodeList.get(i);
                        if (fclBuy1.getCostId().getId().equals(genObj.getId())) {
                            session.setAttribute("costcode", fclBuy1);
                            flag = true;
                            break;
                        }
                    }
                }
                if (!flag) {
                    fclBuyCost.setCostId(genObj);
                    fclBuyCost.setContType(gen);
                    session.setAttribute("costcode", fclBuyCost);
                }

                request.setAttribute("start", startdate);
                request.setAttribute("end", enddate);
                FORWARD = "addfclrecords";

            }
        } //		BUTTON FOR COST TYPE YOU CAN SELECT COST TYPE
        else if (buttonValue != null && buttonValue.equals("costType")) {
            if (startdate != null && startdate != "") {
                Date start = null;
                start = sdf.parse(startdate);
                fclBuy.setStartDate(start);
            }
            if (enddate != null && enddate != "") {
                Date end = null;
                end = sdf.parse(enddate);
                fclBuy.setEndDate(end);
            }
            request.setAttribute("start", startdate);
            request.setAttribute("end", enddate);
            FORWARD = "addfclrecords";
            if (session.getAttribute("costFutureCodeList") != null) {
                costCodeList = (List) session.getAttribute("costFutureCodeList");
                for (int i = 0; i < costCodeList.size(); i++) {
                    fclBuyCost = (FclBuyCost) costCodeList.get(i);
                    if (fclBuyCost != null && fclBuyCost.getCostId() != null) {

                        if (fclBuyCost.getCostId().toString() != null && fclBuyCost.getContType() != null) {
                            if (fclBuyCost.getCostId().getId().toString().equals(costcode) && !fclBuyCost.getContType().getId().toString().equals(costtype)) {
                                count = 1;
                                request.setAttribute("message", "Already your selected different cost type for this cost code");
                                break;
                            }
                        }
                    }
                }
            }

            //THIS IF STATEMENT IS FOR CHECK COSTTYPE TO REDIRECTING TO ADDRECORDS.JSP
            if (request.getAttribute("message") == null) {
                if (costtype != null && !costtype.equals("") && !costtype.equals("0")) {

                    if (session.getAttribute("costcode") != null) {
                        fclBuyCost = (FclBuyCost) session.getAttribute("costcode");

                    } else {
                        fclBuyCost = new FclBuyCost();
                    }
                    GenericCode gen = genericCodeDAO.findById(Integer.parseInt(costtype));
                    fclBuyCost.setContType(gen);
                    session.setAttribute("costcode", fclBuyCost);
                }
            }

            request.setAttribute("start", startdate);
            request.setAttribute("end", enddate);

        } //		THIS IF STATEMENT IS FOR CHECK COSTTYPE AND CREATING SESSION
        else if (buttonValue != null && buttonValue.equals("add") && !buttonValue.equals("")) {

            if (session.getAttribute("costFutureCodeList") != null) {
                costCodeList = (List) session.getAttribute("costFutureCodeList");
            } else {
                costCodeList = new ArrayList();
            }
            if (descCode != null && descCode.trim().equalsIgnoreCase("Flat Rate Per Container Size")) {
                //unit types
                if (session.getAttribute("fclrecordsfuture") != null) {
                    recordsList = (List) session.getAttribute("fclrecordsfuture");

                } else {
                    recordsList = new ArrayList();
                }

                if (session.getAttribute("costcode") != null) {
                    fclBuyCost = (FclBuyCost) session.getAttribute("costcode");
                } else {
                    fclBuyCost = new FclBuyCost();
                }

                if (fclBuyCost.getCostId() != null) {
                    codeNO = fclBuyCost.getCostId().getId();
                }
                fclBuyCostTypeRates = new FclBuyCostTypeFutureRates();

                if (unittype != null && !unittype.equals("0") && !unittype.equals("")) {
                    genericCo = genericCodeDAO.findById(Integer.parseInt(unittype));
                    fclBuyCostTypeRates.setUnitType(genericCo);
                }
                if (currency != null && !currency.equals("0") && !currency.equals("")) {
                    genericCo = genericCodeDAO.findById(Integer.parseInt(currency));
                    fclBuyCostTypeRates.setCurrency(genericCo);
                }
                if (efd != null && !efd.equals("")) {
                    Date start = null;
                    start = sdf.parse(efd);
                    fclBuyCostTypeRates.setEffectiveDate(start);
                }
                if (startdate != null && startdate != "") {
                    Date start = null;
                    start = sdf.parse(startdate);
                    fclBuy.setStartDate(start);
                }
                if (enddate != null && enddate != "") {
                    Date end = null;
                    end = sdf.parse(enddate);
                    fclBuy.setEndDate(end);
                }

                if (efd != null && !efd.equals("")) {
                    Date start = null;
                    start = sdf.parse(efd);
                    fclBuyCostTypeRates.setEffectiveDate(start);
                }
                if (amount != null && !amount.equals("")) {
                    fclBuyCostTypeRates.setActiveAmt(Double.parseDouble(amount));
                } else {
                    fclBuyCostTypeRates.setActiveAmt(0.00);
                }
                if (standard != null && standard.equals("on")) {
                    fclBuyCostTypeRates.setStandard("Y");
                } else {
                    fclBuyCostTypeRates.setStandard("N");
                }


                if (markup != null && !markup.equals("")) {

                    fclBuyCostTypeRates.setMarkup(Double.parseDouble(markup));
                } else {
                    fclBuyCostTypeRates.setMarkup(0.00);
                }
                if (currency != null && !currency.equals("0") && !currency.equals("")) {
                    genericCo = genericCodeDAO.findById(Integer.parseInt(currency));
                    fclBuyCostTypeRates.setCurrency(genericCo);
                }
                fclBuyCostTypeRates.setCostCode(fclBuyCost.getCostId().getCodedesc());
                fclBuyCostTypeRates.setCostType(fclBuyCost.getContType().getCodedesc());
                fclBuyCostTypeRates.setCostId(fclBuyCost.getContType().getId().toString());
                fclBuyCostTypeRates.setTypeId(fclBuyCost.getCostId().getId().toString());
                fclBuyCostTypeRates.setFclCostId(fclBuyCost.getFclStdId());
                recordsList.add(fclBuyCostTypeRates);

                session.setAttribute("fclrecordsfuture", recordsList);

                Set unitTypeSet = new HashSet<FclBuyCostTypeFutureRates>();

                for (int i = 0; i < recordsList.size(); i++) {
                    FclBuyCostTypeFutureRates fclBuyCostType = (FclBuyCostTypeFutureRates) recordsList.get(i);
                    if (fclBuyCostType.getCostCode().equals(fclBuyCost.getCostId().getCodedesc()) && fclBuyCostType.getCostType().equals(fclBuyCost.getContType().getCodedesc())) {
                        unitTypeSet.add(fclBuyCostType);
                    }
                }

                fclBuyCost.setFclBuyFutureTypesSet(unitTypeSet);

            } //END OF IFF
            else if (descCode != null && descCode.trim().equalsIgnoreCase("Air Freight Costs")) {
                if (session.getAttribute("costcode") != null) {
                    fclBuyCost = (FclBuyCost) session.getAttribute("costcode");
                } else {
                    fclBuyCost = new FclBuyCost();
                }
                if (fclBuyCost.getCostId() != null) {
                    codeNO = fclBuyCost.getCostId().getId();
                }
                if (range != null && !range.equals("0") && !range.equals("")) {
                    genericCo = genericCodeDAO.findById(Integer.parseInt(range));
                    fclBuyAirFreightCharges.setWieghtRange(genericCo);
                }
                if (afamount != null && !afamount.equals("")) {
                    fclBuyAirFreightCharges.setRatAmount(Double.parseDouble(afamount));
                }
                if (currency != null && !currency.equals("0") && !currency.equals("")) {
                    genericCo = genericCodeDAO.findById(Integer.parseInt(currency));
                    //fclBuyAirFreightCharges.setCurrency(genericCo);
                }

                fclBuyAirFreightCharges.setCostCode(fclBuyCost.getCostId().getCodedesc());
                fclBuyAirFreightCharges.setCostType(fclBuyCost.getContType().getCodedesc());
                fclBuyAirFreightCharges.setCostId(fclBuyCost.getContType().getId().toString());
                fclBuyAirFreightCharges.setTypeId(fclBuyCost.getCostId().getId().toString());
                //fclBuyAirFreightCharges.setFclCostTypeId(fclBuyCost.getFclStdId());
                if (session.getAttribute("fclfrightrecords") != null) {
                    recordsList = (List) session.getAttribute("fclfrightrecords");
                } else {
                    recordsList = new ArrayList();
                }
                recordsList.add(fclBuyAirFreightCharges);
                session.setAttribute("fclfrightrecords", recordsList);
                Set airFreightSet = new HashSet<FclBuyAirFreightCharges>();
                for (int i = 0; i < recordsList.size(); i++) {
                    FclBuyAirFreightCharges fclBuyAirFreight = (FclBuyAirFreightCharges) recordsList.get(i);
                    if (fclBuyAirFreight.getCostCode().equals(fclBuyCost.getCostId().getCodedesc())
                            && fclBuyAirFreight.getCostType().equals(fclBuyCost.getContType().getCodedesc())) {
                        airFreightSet.add(fclBuyAirFreight);
                    }
                }

                fclBuyCost.setFclBuyAirFreightSet(airFreightSet);
            } else {

                if (session.getAttribute("costcode") != null) {
                    fclBuyCost = (FclBuyCost) session.getAttribute("costcode");
                } else {
                    fclBuyCost = new FclBuyCost();
                }

                if (session.getAttribute("costFutureCodeList") != null) {
                    costCodeList = (List) session.getAttribute("costFutureCodeList");
                    FclBuyCost fclBuyCost1 = new FclBuyCost();
                    for (int i = 0; i < costCodeList.size(); i++) {
                        fclBuyCost1 = (FclBuyCost) costCodeList.get(i);
                        if (fclBuyCost1 != null && fclBuyCost1.getCostId() != null) {

                            if (fclBuyCost1.getCostId().toString() != null && fclBuyCost1.getContType() != null) {
                                if (fclBuyCost1.getCostId().getId().toString().equals(costcode) && fclBuyCost1.getContType().getId().toString().equals(costtype)) {
                                    request.setAttribute("message", "Already your selected different cost type for this cost code");
                                    count = 1;
                                    break;
                                }
                            }
                        }
                    }
                }
                if (session.getAttribute("fclrecordsfuture") != null) {
                    recordsList = (List) session.getAttribute("fclrecordsfuture");
                } else {
                    recordsList = new ArrayList();
                }

                if (count != 1) {

                    if (pcctc != null && !pcctc.equals("")) {
                        fclBuyCostTypeRates.setCtcAmt(Double.parseDouble(pcctc));
                    }
                    if (pccmi != null && !pccmi.equals("")) {
                        fclBuyCostTypeRates.setMinimumAmt(Double.parseDouble(pccmi));
                    }
                    if (pcftf != null && !pcftf.equals("")) {
                        fclBuyCostTypeRates.setFtfAmt(Double.parseDouble(pcftf));
                    }
                    if (pcretail != null && !pcretail.equals("")) {
                        fclBuyCostTypeRates.setRatAmount(Double.parseDouble(pcretail));
                    }
                    if (currency != null && !currency.equals("0") && !currency.equals("")) {
                        genericCo = genericCodeDAO.findById(Integer.parseInt(currency));
                        fclBuyCostTypeRates.setCurrency(genericCo);
                    }
                    if (efd != null && !efd.equals("")) {
                        Date start = null;
                        start = sdf.parse(efd);
                        fclBuyCostTypeRates.setEffectiveDate(start);
                    }
                    fclBuyCostTypeRates.setCostCode(fclBuyCost.getCostId().getCodedesc());
                    fclBuyCostTypeRates.setCostType(fclBuyCost.getContType().getCodedesc());
                    fclBuyCostTypeRates.setCostId(fclBuyCost.getContType().getId().toString());
                    fclBuyCostTypeRates.setTypeId(fclBuyCost.getCostId().getId().toString());
                    //fclBuyCostTypeRates.setFclCostId(fclBuyCost.getFclStdId());
                    if (count != 1) {
                        recordsList.add(fclBuyCostTypeRates);
                    }
                    session.setAttribute("fclrecordsfuture", recordsList);

                    for (int i = 0; i < recordsList.size(); i++) {
                        if (fclBuyCost.getCostId().getCodedesc().equals(fclBuyCostTypeRates.getCostCode())
                                && fclBuyCost.getContType().getCodedesc().equals(fclBuyCostTypeRates.getCostType())) {
                            fclset.add(fclBuyCostTypeRates);
                        }
                    }

                    fclBuyCost.setFclBuyFutureTypesSet(fclset);

                }
            }

            costCodeList = new ArrayList();
            boolean b = false;
            if (session.getAttribute("costFutureCodeList") != null) {
                costCodeList = (List) session.getAttribute("costFutureCodeList");
                if (costcode != null && !costcode.equals("0") && !costcode.equals("")) {
                    GenericCode gen = null;
                    genObj = genericCodeDAO.findById(Integer.parseInt(costcode));
                }

                for (int k1 = 0; k1 < costCodeList.size(); k1++) {
                    FclBuyCost f1 = (FclBuyCost) costCodeList.get(k1);

                    if (genObj != null && f1 != null && genObj.getId() != null && f1.getCostId() != null && genObj.getId().equals(f1.getCostId().getId())) {
                        b = true;
                    }
                }
                if (costCodeList.size() > 0) {
                    for (int k = 0; k < costCodeList.size(); k++) {
                        FclBuyCost f1 = (FclBuyCost) costCodeList.get(k);
                        if (!b) {
                            if (f1.getCostId() != null && fclBuyCost != null && f1.getCostId().getId() != null && fclBuyCost.getCostId() != null) {
                                if (f1.getCostId().getId().toString().equals(fclBuyCost.getCostId().getId().toString())
                                        && f1.getContType().getId().toString().equals(fclBuyCost.getContType().getId().toString())) {
                                    costCodeList.remove(f1);
                                    costCodeList.add(fclBuyCost);
                                    break;
                                } else {
                                    costCodeList.add(fclBuyCost);
                                    break;
                                }
                            }
                        }
                    }
                } else {
                    costCodeList.add(fclBuyCost);
                }
            } else {
                costCodeList.add(fclBuyCost);
            }
            if (costCodeList.size() > 0) {
                for (int k = 0; k < costCodeList.size(); k++) {
                    FclBuyCost f1 = (FclBuyCost) costCodeList.get(k);
                }
            }
            session.setAttribute("costFutureCodeList", costCodeList);


            request.setAttribute("start", startdate);
            request.setAttribute("end", enddate);
            FORWARD = "addfclrecords";
        } else if (buttonValue != null && !buttonValue.equals("") && buttonValue.equals("edit")) {
//		
            FclBuy updatefclBuy = null;
            if (session.getAttribute("futureaddfclrecords") != null) {
                //fclBuy fclBuy=new fclBuy();
                updatefclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
                updatefclBuy.setComNum(updatefclBuy.getComNum());
                updatefclBuy.setDestinationPort(updatefclBuy.getDestinationPort());
                updatefclBuy.setOriginTerminal(updatefclBuy.getOriginTerminal());
                updatefclBuy.setSslineNo(updatefclBuy.getSslineNo());
                updatefclBuy.setContract(contract);
                if (startdate != null && startdate != "") {

                    Date start = null;
                    start = sdf.parse(startdate);
                    updatefclBuy.setStartDate(start);
                }
                if (enddate != null && enddate != "") {
                    Date end = null;
                    end = sdf.parse(enddate);
                    updatefclBuy.setEndDate(end);
                }

            }//if Closed session.getAttribute("futureaddfclrecords")

            //updatefclBuy.setFclBuyCostsSet(null);
            Set fclBuycost1 = new HashSet<FclBuyCost>();
            List alist = new ArrayList();
            if (session.getAttribute("costFutureCodeList") != null) {
                if (updatefclBuy.getFclStdId() != null) {
                    recordid = updatefclBuy.getFclStdId().toString();
                }
                programid = (String) session.getAttribute("processinfoforfl");
                dbUtil.getProcessInfo(programid, recordid, "deleted", "edited");
                List CodeList = new ArrayList();
                if (session.getAttribute("searchFutureFclcodelist") != null) {
                    List newCodeList = (List) session.getAttribute("searchFutureFclcodelist");
                    CodeList.addAll(newCodeList);
                    Set removeList = new HashSet(newCodeList);
                    for (Iterator iter = newCodeList.iterator(); iter.hasNext();) {
                        FclBuyCost fclBuyCostId = (FclBuyCost) iter.next();
                        if (fclBuyCostId != null && updatefclBuy != null && fclBuyCostId.getFclStdId() != null && updatefclBuy.getFclStdId() != null && updatefclBuy.getFclStdId().equals(fclBuyCostId.getFclStdId())) {
                            CodeList.remove(fclBuyCostId);
                        }
                    }
                }
                Set getold = updatefclBuy.getFclBuyCostsSet();
                updatefclBuy.setFclBuyCostsSet(null);
                Iterator it2 = null;
                Set newset = new HashSet();
                if (getold != null) {
                    it2 = getold.iterator();


                    while (it2.hasNext()) {
                        fclBuyCost = (FclBuyCost) it2.next();
                        newset.add(fclBuyCost);
                    }
                }
                costCodeList = (List) session.getAttribute("costFutureCodeList");
                for (int i = 0; i < costCodeList.size(); i++) {
                    boolean flag = true;
                    FclBuyCost fclBuyCostChanges = (FclBuyCost) costCodeList.get(i);
                    it2 = newset.iterator();
                    while (it2.hasNext()) {
                        fclBuyCost = (FclBuyCost) it2.next();
                        if (fclBuyCostChanges != null && fclBuyCost != null && fclBuyCostChanges.getCostId() != null && fclBuyCost.getCostId() != null && fclBuyCostChanges.getCostId().getId().equals(fclBuyCost.getCostId().getId())) {
                            Set fururenewset = new HashSet();

                            if (fclBuyCostChanges.getFclBuyFutureTypesSet() != null) {
                                Iterator futurerate = fclBuyCostChanges.getFclBuyFutureTypesSet().iterator();
                                while (futurerate.hasNext()) {

                                    fclBuyCostTypeRates = (FclBuyCostTypeFutureRates) futurerate.next();
                                    fururenewset.add(fclBuyCostTypeRates);
                                }
                            }
                            fclBuyCost.setFclBuyFutureTypesSet(fururenewset);
                            fclBuycost1.add(fclBuyCost);
                            newset.remove(fclBuyCost);
                            flag = false;
                            break;
                        }
                    }
                    if (flag) {
                        fclBuycost1.add(fclBuyCostChanges);
                    }
                }
                it2 = newset.iterator();
                while (it2.hasNext()) {
                    FclBuyCost ff = (FclBuyCost) it2.next();
                    fclBuycost1.add(ff);
                }
                updatefclBuy.setFclBuyCostsSet(fclBuycost1);
                fclBuyDAO.update(updatefclBuy);

                Set retrive = new HashSet<FclBuyCost>();
                FclBuy addrecords = fclBuyDAO.findById(updatefclBuy.getFclStdId());


                if (addrecords.getFclBuyCostsSet() != null) {
                    retrive = addrecords.getFclBuyCostsSet();
                    Iterator it = retrive.iterator();
                    while (it.hasNext()) {
                        fclBuyCost = (FclBuyCost) it.next();
                        fclBuyCost.setFclStdId(addrecords.getFclStdId());

                        if (fclBuyCost.getFclBuyFutureTypesSet() != null) {
                            Iterator setIt = fclBuyCost.getFclBuyFutureTypesSet().iterator();
                            while (setIt.hasNext()) {
                                FclBuyCostTypeFutureRates furate = (FclBuyCostTypeFutureRates) setIt.next();
                                furate.setFclCostId(fclBuyCost.getFclCostId());
                                if (furate != null && fclBuyCost != null && furate.getFclCostId() != null && fclBuyCost.getFclCostId() != null && furate.getFclCostId().equals(fclBuyCost.getFclCostId())) {
                                    CodeList.add(fclBuyCost);
                                    break;
                                }
                            }
                        }
                    }
                }

                FclBuy fl = new FclBuy();
                fl.setComNum(updatefclBuy.getComNum());
                fl.setDestinationPort(updatefclBuy.getDestinationPort());
                fl.setOriginTerminal(updatefclBuy.getOriginTerminal());
                fl.setSslineNo(updatefclBuy.getSslineNo());
                //session.setAttribute("futuresearchfclrecords",fl);
                session.setAttribute("searchFutureFclcodelist", CodeList);

                List value = new ArrayList();
                unittypelist = dbUtil.getUnitListForFCLTest(new Integer(38), "yes", "Select Unit code");
                for (int i = 0; i < unittypelist.size(); i++) {
                    LabelValueBean removegenCo = (LabelValueBean) unittypelist.get(i);
                    if (!removegenCo.getValue().equals("0")) {
                        value.add(removegenCo.getLabel());
                    }
                }
                session.setAttribute("searchunittypelist", value);
                session.setAttribute("fclmessage", "Record has Edited successfully");
                if (session.getAttribute("con") != null) {
                    session.removeAttribute("con");
                }
                if (session.getAttribute("editrecords") != null) {
                    session.removeAttribute("editrecords");
                }
                if (session.getAttribute("fclfrightrecords") != null) {
                    session.removeAttribute("fclfrightrecords");
                }
                if (session.getAttribute("addfclrecords") != null) {
                    session.removeAttribute("addfclrecords");
                }
                //if(session.getAttribute("costCodeList")!=null)session.removeAttribute("costCodeList");

                if (session.getAttribute("costFutureCodeList") != null) {
                    session.removeAttribute("costFutureCodeList");
                }
                if (session.getAttribute("fclrecordsfuture") != null) {
                    session.removeAttribute("fclrecordsfuture");
                }


            }//if for session

            FORWARD = "fclsearch";
        } //end of buttonValue edit
        else if (buttonValue != null && buttonValue.equals("delete")) {
            if (session.getAttribute("futureaddfclrecords") != null) {

                fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
            }

            if (fclBuy.getFclStdId() != null) {
                recordid = fclBuy.getFclStdId().toString();
            }
            programid = (String) session.getAttribute("processinfoforfl");
            dbUtil.getProcessInfo(programid, recordid, "deleted", "edited");
            if (fclBuy.getComNum() != null && fclBuy.getComNum().getCode().equals("000000")) {
                if (session.getAttribute("fclcommonList") != null) {
                    session.removeAttribute("fclcommonList");
                }
            } else {
                if (session.getAttribute("searchFclcodelist") != null) {
                    session.removeAttribute("searchFclcodelist");
                }
            }
            fclBuyDAO.delete(fclBuy);
            session.setAttribute("fclmessage", "Record has deleted successfully");
            if (session.getAttribute("editrecords") != null) {
                session.removeAttribute("editrecords");
            }
            if (session.getAttribute("fclfrightrecords") != null) {
                session.removeAttribute("fclfrightrecords");
            }
            if (session.getAttribute("costcode") != null) {
                session.removeAttribute("costcode");
            }
            if (session.getAttribute("costFutureCodeList") != null) {
                session.removeAttribute("costFutureCodeList");
            }
            if (session.getAttribute("fclfrightrecords") != null) {
                session.removeAttribute("fclfrightrecords");
            }
            if (session.getAttribute("unittypelist") != null) {
                session.removeAttribute("unittypelist");
            }
            if (session.getAttribute("fclrecordsfuture") != null) {
                session.removeAttribute("fclrecordsfuture");
            }
            if (session.getAttribute("fclrecordsfuture") != null) {
                session.removeAttribute("fclrecordsfuture");
            }
            if (session.getAttribute("con") != null) {
                session.removeAttribute("con");
            }
            if (session.getAttribute("futureaddfclrecords") != null) {
                session.removeAttribute("futureaddfclrecords");
            }
            if (session.getAttribute("fclcommonList") != null) {
                session.removeAttribute("fclcommonList");
            }
            if (session.getAttribute("futuresearchfclrecords") != null) {
                session.removeAttribute("futuresearchfclrecords");
            }
            if (session.getAttribute("searchFclcodelist") != null) {
                session.removeAttribute("searchFclcodelist");
            }
            FORWARD = "fclsearch";
        }

        if (buttonValue != null && buttonValue.equals("index")) {
            if (buy != null && !buy.equals("")) {

                request.setAttribute("buy", "buy");
            }
            FORWARD = "addfclrecords";
        } else if (buttonValue != null && buttonValue.equals("cancel")) {
            if (session.getAttribute("futureaddfclrecords") != null) {
                fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
            }
            if (fclBuy.getFclStdId() != null) {
                recordid = fclBuy.getFclStdId().toString();
            }
            programid = (String) session.getAttribute("processinfoforfl");

            dbUtil.getProcessInfo(programid, recordid, "deleted", "edited");
            if (session.getAttribute("usermessage") != null) {
                session.removeAttribute("usermessage");
            }
            if (session.getAttribute("con") != null) {
                session.removeAttribute("con");
            }
            if (session.getAttribute("costFutureCodeList") != null) {
                session.removeAttribute("costFutureCodeList");
            }
            if (session.getAttribute("fclrecordsfuture") != null) {
                session.removeAttribute("fclrecordsfuture");
            }
            if (request.getAttribute("usermessage") != null) {
                session.removeAttribute("usermessage");
            }
            if (request.getAttribute("view") != null) {
                session.removeAttribute("view");
            }
            if (session.getAttribute("fclfrightrecords") != null) {
                session.removeAttribute("fclfrightrecords");
            }
            if (session.getAttribute("costcode") != null) {
                session.removeAttribute("costcode");
            }
            if (session.getAttribute("futureaddfclrecords") != null) {
                session.removeAttribute("futureaddfclrecords");
            }
            if (session.getAttribute("fclrecordsfuture") != null) {
                session.removeAttribute("fclrecordsfuture");
            }

            FORWARD = "fclsearch";

        } else if (buttonValue != null && buttonValue.equals("note")) {
            /*if(startdate!=null && startdate!="")
            {
            Date start=null;
            try
            {	SimpleDateFormat sdf=new SimpleDateFormat("MM/dd/yyyy");
            start=sdf.parse(startdate);
            }
            catch (ParseException e){
            e.printStackTrace();
            }
            fclBuy.setStartDate(start);
            }
            if(enddate!=null && enddate!="")
            {
            Date end=null;
            try
            {	SimpleDateFormat sdf=new SimpleDateFormat("MM/dd/yyyy");
            end=sdf.parse(enddate);
            }
            catch (ParseException e){
            e.printStackTrace();
            }
            fclBuy.setEndDate(end);

            }
            request.setAttribute("start", startdate);
            request.setAttribute("end", enddate);*/
            if (session.getAttribute("futureaddfclrecords") != null) {
                fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
            }

            ItemDAO itemDAO = new ItemDAO();
            Item item = new Item();
            String itemName = "";
            if (session.getAttribute("processinfoforfl") != null) {
                String itemId = (String) session.getAttribute("processinfoforfl");
                item = itemDAO.findById(Integer.parseInt(itemId));
                itemName = item.getItemDesc();

            }


            AuditLogRecord auditLogRecord = new AuditLogRecordFcl();
            NoteBean noteBean = new NoteBean();
            noteBean.setItemName(itemName);
            noteBean.setAuditLogRecord(auditLogRecord);
            noteBean.setButtonValue(buttonValue);
            //noteBean.setUser(user);
            noteBean.setPageName("cancelFcldetails");
            String noteId = "";

            if (fclBuy.getFclStdId() != null) {
                noteId = fclBuy.getFclStdId().toString();

                noteBean.setNoteId(noteId);
                noteBean.setReferenceId(noteId);
            }



            List auditList = null;

            auditList = dbUtil.getNoteInformation(noteId, auditLogRecord);
            noteBean.setAuditList(auditList);
            noteBean.setVoidednote("");
            request.setAttribute("noteBean", noteBean);
            String documentName = "User";
            request.setAttribute("buttonValue", buttonValue);
            //session.setAttribute("document",documentName);
            if (fclBuy.getFclStdId() != null) {
                recordid = fclBuy.getFclStdId().toString();
            }
            programid = (String) session.getAttribute("processinfoforfl");
            dbUtil.getProcessInfo(programid, recordid, "deleted", "edited");

            FORWARD = "note";

        } else if (buttonValue != null && buttonValue.equals("copy")) {
            FclBuy fcll = new FclBuy();
            fcll = (FclBuy) session.getAttribute("futureaddfclrecords");
            fcll.getFclStdId();
            session.setAttribute("getBackAddFcl", fcll.getFclStdId());
            FORWARD = "copy";

        } else if (buttonValue != null && !buttonValue.equals("") && buttonValue.equals("copysave")) {
            boolean flag1 = false;
            boolean send = false;
            List list = new ArrayList();
            DBUtil dbutil = new DBUtil();
            if (startdate != null && startdate != "") {
                Date start = null;
                start = sdf.parse(startdate);
                fclBuy.setStartDate(start);
            }
            if (enddate != null && enddate != "") {
                Date end = null;
                end = sdf.parse(enddate);
                fclBuy.setEndDate(end);
            }
            fclBuy.setContract(contract);
            if (session.getAttribute("costcode") != null) {
                fclBuyCost = (FclBuyCost) session.getAttribute("costcode");
            } else {
                fclBuyCost = new FclBuyCost();
            }

            if (trmNum != null && !trmNum.equals("")) {
                List unLocationList = portsDAO.findForManagement(trmNum, null);
                if (unLocationList != null && unLocationList.size() > 0) {
                    UnLocation refTerminal = (UnLocation) unLocationList.get(0);
                    fclBuy.setOriginTerminal(refTerminal);
                    session.setAttribute("futureaddfclrecords", fclBuy);
                } else {
                    //RefTerminalTemp r1=null;
                    //fclBuy.setOriginTerminal(r1);
                    //session.setAttribute("futureaddfclrecords", fclBuy);
                    //request.setAttribute("alertmsg", "Enter Proper Org Terminal");
                    send = true;

                }
            } else {
                //RefTerminalTemp r1=null;
                //fclBuy.setOriginTerminal(r1);
                //session.setAttribute("futureaddfclrecords", fclBuy);
            }

            if (portNum != null && !portNum.equals("")) {
                List portsList = portsDAO.findForManagement(portNum, null);
                if (portsList != null && portsList.size() > 0) {
                    UnLocation ports = (UnLocation) portsList.get(0);
                    fclBuy.setDestinationPort(ports);
                    session.setAttribute("futureaddfclrecords", fclBuy);
                } else {
                    send = true;
                }
            } else {
                //PortsTemp p1=null;
                //fclBuy.setDestinationPort(p1);
                //session.setAttribute("futureaddfclrecords", fclBuy);
            }

            if (comCode != null && !comCode.equals("")) {
                List comList = genericCodeDAO.findForGenericCode(comCode);
                if (comList != null && comList.size() > 0) {
                    GenericCode gen = (GenericCode) comList.get(0);
                    fclBuy.setComNum(gen);
                    session.setAttribute("futureaddfclrecords", fclBuy);
                } else {
                    //GenericCode g1=null;
                    //fclBuy.setComNum(g1);
                    //session.setAttribute("futureaddfclrecords", fclBuy);
                    send = true;
                    //request.setAttribute("alertmsg", "Enter Proper Commodity ");
                }
            } else {
                //GenericCode g1=null;
                //fclBuy.setComNum(g1);
                //session.setAttribute("futureaddfclrecords", fclBuy);
            }
            if (sslineNO != null && !sslineNO.equals("") || (ssName != null && !ssName.equals(""))) {

                List SSNo = carriersOrLineDAO.findAccountNo1(sslineNO);
                if (SSNo != null && SSNo.size() > 0) {
                    carriersOrLineTemp = (TradingPartnerTemp) SSNo.get(0);
                    fclBuy.setSslineNo(carriersOrLineTemp);
                    session.setAttribute("futureaddfclrecords", fclBuy);
                } else {
                    //CarriersOrLineTemp c1=null;
                    //fclBuy.setSslineNo(c1);
                    //session.setAttribute("futureaddfclrecords", fclBuy);
                    //request.setAttribute("alertmsg", "Enter Proper SSLine Number");
                    send = true;
                }
            } else {
                //CarriersOrLineTemp c1=null;
                //fclBuy.setSslineNo(c1);
                //session.setAttribute("futureaddfclrecords", fclBuy);
            }
            if (session.getAttribute("futureaddfclrecords") != null) {

                fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
                fclBuy.setComNum(fclBuy.getComNum());
                fclBuy.setDestinationPort(fclBuy.getDestinationPort());
                fclBuy.setOriginTerminal(fclBuy.getOriginTerminal());
                fclBuy.setSslineNo(fclBuy.getSslineNo());
                fclBuy.setContract(contract);



                if (startdate != null && startdate != "") {
                    Date start = null;
                    start = sdf.parse(startdate);
                    fclBuy.setStartDate(start);
                }
                if (enddate != null && enddate != "") {
                    Date end = null;
                    end = sdf.parse(enddate);
                    fclBuy.setEndDate(end);

                }

            }
            if (index != null && index.equals("getInster")) {
                if (fclBuy != null) {
                    list = dbutil.getFCLDetails(fclBuy.getOriginTerminal(), fclBuy.getDestinationPort(), fclBuy.getComNum(), fclBuy.getSslineNo(), fclBuy.getOriginalRegion(), fclBuy.getDestinationRegion());
                    if (list != null && list.size() > 0) {
                        flag1 = true;
                        request.setAttribute("message", "This records is exists Please Change Org Trm or Dest Port or Commodity Code");
                    }
                }
            }
            if (!flag1 && !send && index != null && index.equals("getInster")) {

                if (fclBuy.getFclStdId() != null) {
                    recordid = fclBuy.getFclStdId().toString();
                }
                programid = (String) session.getAttribute("processinfoforfl");

                dbUtil.getProcessInfo(programid, recordid, "deleted", "edited");


                if (session.getAttribute("fclcommonList") != null) {

                    session.removeAttribute("fclcommonList");
                }
                if (session.getAttribute("costFutureCodeList") != null) {
                    costCodeList = (List) session.getAttribute("costFutureCodeList");
                    for (int i = 0; i < costCodeList.size(); i++) {
                        fclBuyCost = (FclBuyCost) costCodeList.get(i);
                        //fclBuyCost.setFclStdId(fclBuy.getFclStdId());
                        if (fclBuyCost.getContType() != null) {
                            costtype = fclBuyCost.getContType().getId().toString();
                        }
                        fclset.add(fclBuyCost);
                    }
                    fclBuy.setFclBuyCostsSet(fclset);

                    fclBuyDAO.save(fclBuy);

                    List CodeList = new ArrayList();
                    List comList = new ArrayList();
                    Set retrive = new HashSet<FclBuyCost>();

                    if (fclBuy.getComNum() != null && fclBuy.getComNum().getCode().equals("000000")) {
                        genObj = genericCodeDAO.findById(11292);
                        List lii = fclBuyDAO.findForSearchFclBuyRatesMatch(fclBuy.getOriginTerminal(), fclBuy.getDestinationPort(), genObj, null);
                        for (int i = 0; i < lii.size(); i++) {
                            FclBuy fby = (FclBuy) lii.get(i);
                            if (fby.getFclBuyCostsSet() != null) {
                                retrive = fby.getFclBuyCostsSet();
                                Iterator it = retrive.iterator();
                                while (it.hasNext()) {
                                    fclBuyCost = (FclBuyCost) it.next();
                                    fclBuyCost.setFclStdId(fby.getFclStdId());
                                    comList.add(fclBuyCost);

                                }
                            }

                        }

                    } else {
                        genObj = genericCodeDAO.findById(11292);
                        List lii = fclBuyDAO.findForSearchFclBuyRatesMatch(fclBuy.getOriginTerminal(), fclBuy.getDestinationPort(), genObj, null);
                        for (int i = 0; i < lii.size(); i++) {
                            FclBuy fby = (FclBuy) lii.get(i);
                            if (fby.getFclBuyCostsSet() != null) {
                                retrive = fby.getFclBuyCostsSet();
                                Iterator it = retrive.iterator();
                                while (it.hasNext()) {
                                    fclBuyCost = (FclBuyCost) it.next();
                                    fclBuyCost.setFclStdId(fby.getFclStdId());
                                    comList.add(fclBuyCost);

                                }
                            }

                        }
                        if (fclBuy.getFclBuyCostsSet() != null) {
                            retrive = fclBuy.getFclBuyCostsSet();
                            Iterator it = retrive.iterator();
                            while (it.hasNext()) {
                                fclBuyCost = (FclBuyCost) it.next();
                                fclBuyCost.setFclStdId(fclBuy.getFclStdId());
                                CodeList.add(fclBuyCost);

                            }
                        }
                    }
                    session.setAttribute("searchFclcodelist", CodeList);
                    session.setAttribute("fclcommonList", comList);

                    List value = new ArrayList();
                    unittypelist = dbUtil.getUnitListForFCLTest(new Integer(38), "yes", "Select Unit code");
                    for (int i = 0; i < unittypelist.size(); i++) {
                        LabelValueBean removegenCo = (LabelValueBean) unittypelist.get(i);
                        if (!removegenCo.getValue().equals("0")) {
                            value.add(removegenCo.getLabel());
                        }
                    }
                    session.setAttribute("searchunittypelist", value);
                    FclBuy fl = new FclBuy();
                    fl.setComNum(fclBuy.getComNum());
                    fl.setDestinationPort(fclBuy.getDestinationPort());
                    fl.setOriginTerminal(fclBuy.getOriginTerminal());
                    fl.setSslineNo(fclBuy.getSslineNo());

                    session.setAttribute("futuresearchfclrecords", fl);
                    session.setAttribute("fclmessage", "Record has Added successfully");

                }

                if (session.getAttribute("con") != null) {
                    session.removeAttribute("con");
                }
                if (session.getAttribute("editrecords") != null) {
                    session.removeAttribute("editrecords");
                }
                if (session.getAttribute("fclfrightrecords") != null) {
                    session.removeAttribute("fclfrightrecords");
                }
                if (session.getAttribute("futureaddfclrecords") != null) {
                    session.removeAttribute("futureaddfclrecords");
                }
                if (session.getAttribute("fclfrightrecords") != null) {
                    session.removeAttribute("fclfrightrecords");
                }
                if (session.getAttribute("fclrecordsfuture") != null) {
                    session.removeAttribute("fclrecordsfuture");
                }
                if (session.getAttribute("getBackAddFcl") != null) {
                    session.removeAttribute("getBackAddFcl");
                }
                FORWARD = "fclsearch";
            } else {

                FORWARD = "existrecords";


            }
        } else if (buttonValue != null && buttonValue.equals("copycancel")) {

            if (session.getAttribute("futureaddfclrecords") != null) {
                session.removeAttribute("futureaddfclrecords");

            }
            if (session.getAttribute("con") != null) {
                session.removeAttribute("con");
            }
            if (session.getAttribute("getBackAddFcl") != null) {
                FclBuy fclb = new FclBuy();
                Integer i = (Integer) session.getAttribute("getBackAddFcl");
                FclBuyDAO fcl = new FclBuyDAO();
                fclb = fcl.findById(i.valueOf(i));
                session.setAttribute("futureaddfclrecords", fclb);
                session.setAttribute("con", fclb);
            }
            FORWARD = "copycancel";

        } else if (buttonValue != null && buttonValue.equals("gethistory")) {
            List getList = new ArrayList();
            List getListnew = new ArrayList();
            if (session.getAttribute("futureaddfclrecords") != null) {
                fclBuy = (FclBuy) session.getAttribute("futureaddfclrecords");
                FclBuy fclrecords = fclBuyDAO.findById(fclBuy.getFclStdId());
                if (fclrecords.getFclBuyCostsSet() != null) {
                    Iterator it = fclrecords.getFclBuyCostsSet().iterator();
                    while (it.hasNext()) {
                        fclBuyCost = (FclBuyCost) it.next();
                        getList = fclBuyDAO.getFclHistory(fclBuyCost.getFclCostId());
                        for (int i = 0; i < getList.size(); i++) {
                            FclBuyCostTypeFutureRatesHisptory ff = (FclBuyCostTypeFutureRatesHisptory) getList.get(i);
                            ff.setCostCode(fclBuyCost.getCostId().getCodedesc());
                            ff.setCostType(fclBuyCost.getContType().getCodedesc());
                            getListnew.add(ff);
                        }
                    }
                }

            }
            session.setAttribute("getFclHistry", getList);

            FORWARD = "getHistroy";
        }
        if (request.getAttribute("view") != null) {
            session.removeAttribute("view");
        }

        return mapping.findForward(FORWARD);
    }
}
