/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cong.logisoft.struts.action;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import com.gp.cong.logisoft.domain.GenericCode;
import com.gp.cong.logisoft.domain.Ports;
import com.gp.cong.logisoft.domain.RelayInquiry;
import com.gp.cong.logisoft.domain.RelayOrigin;
import com.gp.cong.logisoft.hibernate.dao.GenericCodeDAO;
import com.gp.cong.logisoft.hibernate.dao.PortsDAO;
import com.gp.cong.logisoft.hibernate.dao.RelayInquiryDAO;
import com.gp.cong.logisoft.hibernate.dao.RelayOriginDAO;
import com.gp.cong.logisoft.struts.form.AddOriginForm;
import com.gp.cong.logisoft.struts.form.EditOriginForm;

/** 
 * MyEclipse Struts
 * Creation date: 12-15-2007
 * 
 * XDoclet definition:
 * @struts.action path="/addOrigin" name="addOriginForm" input="/jsps/datareference/addOrigin.jsp" scope="request" validate="true"
 */
public class EditOriginAction extends Action {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		EditOriginForm editOriginForm = (EditOriginForm) form;// TODO Auto-generated method stub
		HttpSession session = ((HttpServletRequest)request).getSession();
		
		String originCode=editOriginForm.getOriginCode();
		String originName=editOriginForm.getOriginName();
		String ttToPol=editOriginForm.getTtToPol();
		String cutOffDayOfWeek=editOriginForm.getCutOffDayOfWeek();
		String cutOffTime=editOriginForm.getCutOffTime();
		String buttonValue=editOriginForm.getButtonValue();
		String forwardName="";
		GenericCode week=new GenericCode();
		GenericCodeDAO genericCodeDAO=new GenericCodeDAO();
		RelayOrigin relayOrigin=null;
		List neworiginList=null;
		List deleteoriginList=null;
		if(!buttonValue.equals("cancel") && !buttonValue.equals("update") && !buttonValue.equals("delete"))
		{
			if(session.getAttribute("relayOrigin")!=null)
			{
				relayOrigin=(RelayOrigin)session.getAttribute("relayOrigin");
			}
			else
			{
				relayOrigin=new RelayOrigin();
			}
			
			
			if(cutOffDayOfWeek!=null && !cutOffDayOfWeek.equals("0"))
			{	
				week=genericCodeDAO.findById(Integer.parseInt(cutOffDayOfWeek));
				relayOrigin.setCutOffDayOfWeek(week);
			}
			if(ttToPol!=null && !ttToPol.equals(""))
			{	
				relayOrigin.setTtToPol(Integer.parseInt(ttToPol));
			}
			if(cutOffTime!=null && !cutOffTime.equals(""))
			{	
				relayOrigin.setCutOffTime(Integer.parseInt(cutOffTime));
			}
			session.setAttribute("relayOrigin",relayOrigin);
			forwardName="editorigin";
		}
		if(buttonValue.equals("add"))
		{
			List originList=null;
			if(session.getAttribute("originList")!=null)
			{
				originList=(List)session.getAttribute("originList");
				
			}
			else
			{
				originList=new ArrayList();
			}
			if(session.getAttribute("neworiginList")!=null)
			{
				neworiginList=(List)session.getAttribute("neworiginList");
			}
			else
			{
				neworiginList=new ArrayList();
			}
			boolean flag=false;
			for(int i=0;i<originList.size();i++)
			{
				RelayOrigin port1=(RelayOrigin)originList.get(i);
				String portScheduleNumber = null;
				String relayScheduleNumber = null;
				
				if(port1 != null && port1.getOriginId() !=null && port1.getOriginId().getShedulenumber()!=null){
					portScheduleNumber = port1.getOriginId().getShedulenumber();
				}
				if(relayOrigin != null && relayOrigin.getOriginId()!= null && relayOrigin.getOriginId().getShedulenumber()!= null){
					relayScheduleNumber = relayOrigin.getOriginId().getShedulenumber();
				}
				
				if(portScheduleNumber != null && relayScheduleNumber != null && portScheduleNumber.equals(relayScheduleNumber))
				{
					if(port1.getOriginId().getControlNo().equals(relayOrigin.getOriginId().getControlNo()))
					{
						flag=true;
						break;
					}
				}
			}
			
				if(flag)
				{
					String msg="This port is already added";
					request.setAttribute("msg",msg);
					buttonValue="";
				}
				else
				{
			neworiginList.add(relayOrigin);
			originList.add(relayOrigin);
			session.setAttribute("neworiginList", neworiginList);
			
			session.setAttribute("originList",originList);
			session.removeAttribute("relayOrigin");
				}
		}
		if(buttonValue.equals("update"))
		{
			if(session.getAttribute("relayOrigin")!=null)
			{
				relayOrigin=(RelayOrigin)session.getAttribute("relayOrigin");
				relayOrigin.setOriginId(relayOrigin.getOriginId());
				relayOrigin.setTtToPol(Integer.parseInt(editOriginForm.getTtToPol()));
				if(cutOffDayOfWeek!=null && !cutOffDayOfWeek.equals("0"))
				{	
					week=genericCodeDAO.findById(Integer.parseInt(cutOffDayOfWeek));
					relayOrigin.setCutOffDayOfWeek(week);
				}
				relayOrigin.setCutOffTime(Integer.parseInt(editOriginForm.getCutOffTime()));
			}
			forwardName="editorigin";
			session.removeAttribute("relayOrigin");
		}
		if(buttonValue.equals("delete"))
		{
			if(session.getAttribute("relayOrigin")!=null)
			{
				relayOrigin=(RelayOrigin)session.getAttribute("relayOrigin");
			}
			if(session.getAttribute("deleteoriginList")!=null)
			{
				deleteoriginList=(List)session.getAttribute("deleteoriginList");
			}
			else
			{
				deleteoriginList=new ArrayList();
			}
			deleteoriginList.add(relayOrigin);
			session.setAttribute("deleteoriginList",deleteoriginList);
			if(session.getAttribute("originList")!=null)
			{
				List originList=(List)session.getAttribute("originList");
				originList.remove(relayOrigin);
			}
			forwardName="editorigin";
			session.removeAttribute("relayOrigin");
		}
		if(buttonValue.equals("cancel"))
		{
		    forwardName="cancel";
		    session.removeAttribute("relayOrigin");
		}
		
		request.setAttribute("buttonValue",buttonValue);
		
		return mapping.findForward(forwardName);
	}
}