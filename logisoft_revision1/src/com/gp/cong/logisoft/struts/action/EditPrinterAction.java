/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cong.logisoft.struts.action;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import com.gp.cong.logisoft.domain.Printer;
import com.gp.cong.logisoft.domain.User;
import com.gp.cong.logisoft.domain.UserPrinterAssociation;
import com.gp.cong.logisoft.hibernate.dao.PrinterDAO;
import com.gp.cong.logisoft.struts.form.EditPrinterForm;

/** 
 * MyEclipse Struts
 * Creation date: 11-19-2007
 * 
 * XDoclet definition:
 * @struts.action path="/editPrinter" name="editPrinterForm" input="/jsps/admin/EditPrinter.jsp" scope="request" validate="true"
 */
public class EditPrinterAction extends Action {
    /*
     * Generated Methods
     */

    /**
     * Method execute
     * @param mapping
     * @param form
     * @param request
     * @param response
     * @return ActionForward
     */
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response) throws Exception {
        HttpSession session = ((HttpServletRequest) request).getSession();
        EditPrinterForm editPrinterForm = (EditPrinterForm) form;// TODO Auto-generated method stub
        String buttonValue = editPrinterForm.getButtonValue();
        String printerType = editPrinterForm.getPrinterType();
        String printerName = editPrinterForm.getPrinterName();
        Printer printer = new Printer();
        Integer printerTye = Integer.parseInt(printerType);
        PrinterDAO printerDAO = new PrinterDAO();
        Printer printerobj = null;
        List printerAddList = null;
        List printerList = null;
        User user = null;
        printerobj = printerDAO.findById(printerTye);

        if (session.getAttribute("printer") == null) {
            printer = new Printer();
        } else {
            printer = (Printer) session.getAttribute("printer");
        }


        printer.setPrinterName(printerobj.getPrinterName());
        //printer.setPrinterType(printerobj.getPrinterType());
        printer.setPrinterId(printerobj.getPrinterId());
        session.setAttribute("printer", printer);

        if (buttonValue.equals("save")) {
            if (session.getAttribute("user") == null) {
                user = new User();
            } else {
                user = (User) session.getAttribute("user");
            //session.removeAttribute("user");
            }
            UserPrinterAssociation userPrinterAssoc = new UserPrinterAssociation();
            PrinterDAO ediPrinterDAO = new PrinterDAO();
            Printer printerNew = ediPrinterDAO.findById(Integer.parseInt(printerName));
            //userPrinterAssoc.setPrinterId(printerNew);

            if (user.getAssocitedPrinter() == null) {
                user.setAssocitedPrinter(new HashSet<UserPrinterAssociation>());
            }
            if (session.getAttribute("printerAddList") == null) {
                printerAddList = new ArrayList();
            } else {
                printerAddList = (List) session.getAttribute("printerAddList");

            }
            user.getAssocitedPrinter().add(userPrinterAssoc);
            //printerAddList.add(userPrinterAssoc.getPrinterId());
            session.setAttribute("user", user);
            session.setAttribute("printerAddList", printerAddList);
        }

        return mapping.findForward("editprinter");
    }
}