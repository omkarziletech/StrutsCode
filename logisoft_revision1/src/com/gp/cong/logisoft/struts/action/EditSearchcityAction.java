/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.gp.cong.logisoft.struts.action;

import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import com.gp.cong.logisoft.struts.form.EditSearchCityForm;
import com.gp.cong.logisoft.beans.CitySelectionBean;
import com.gp.cong.logisoft.domain.RefTerminal;
import com.gp.cong.logisoft.domain.UnLocation;
import com.gp.cong.logisoft.hibernate.dao.*;

/** 
 * MyEclipse Struts
 * Creation date: 02-07-2008
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class EditSearchcityAction extends Action {
    /*
     * Generated Methods
     */

    /**
     * Method execute
     * @param mapping
     * @param form
     * @param request
     * @param response
     * @return ActionForward
     */
    public ActionForward execute(ActionMapping mapping, ActionForm form,
            HttpServletRequest request, HttpServletResponse response) throws Exception {
        // TODO Auto-generated method stub
        String forwardName = "";
        HttpSession session = ((HttpServletRequest) request).getSession(false);
        EditSearchCityForm searchform = (EditSearchCityForm) form;
        String buttonValue = searchform.getButtonValue();
        UnLocationDAO unLocationDAO = new UnLocationDAO();

        CitySelectionBean cbs = new CitySelectionBean();
        if (request.getParameter("index") != null) {
            int ind = Integer.parseInt(request.getParameter("index"));
            List cityList = (List) session.getAttribute("cityDetails");
            CitySelectionBean citySelBean = (CitySelectionBean) cityList.get(ind);
            UnLocation unLoc = citySelBean.getUnloaction();
            RefTerminal terminal = null;
            if (session.getAttribute("terminal") == null) {
                terminal = new RefTerminal();
            } else {
                terminal = (RefTerminal) session.getAttribute("terminal");
            }
            terminal.setCountry(unLoc.getCountryId());
            terminal.setState(unLoc.getStateId().getCodedesc());

            terminal.setUnLocation(unLoc);
            request.setAttribute("buttonValue", "completed");
            session.removeAttribute("cityDetails");
        }
        if (buttonValue != null && buttonValue.equals("search")) {

            List city = unLocationDAO.findbyCity(request.getParameter("city"));
            List cityDetails = cbs.getCityDetails(city);
            session.setAttribute("cityDetails", cityDetails);

        }
        return mapping.findForward("EditSearchpopup");
    }
}